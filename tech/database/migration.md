## 双写方案
1. 将新的库配置为源库的从库，用来同步数据；如果需要将数据同步到多库多表，可以使用第三方工具 Canal 获取 Binlog 的增量日志，然后按照分库分表的逻辑写入到新的库表中

2. 改造业务代码，在数据写入的时候，不仅要写入旧库，也要写入新库。基于性能的考虑，可以异步地写入新库，只要保证旧库写入成功即可。需要注意的是，需要将写入新库失败的数据记录在单独的日志中，方便后续对这些数据补写，保证新库和旧库的数据一致性

3. 开始校验数据了。由于数据库中数据量很大，做全量的数据校验不太现实。可以抽取部分数据，具体数据量依据总体数据量而定，只要保证这些数据是一致的就可以

4. 如果一切顺利，就可以将读流量切换到新库了。最好采用灰度的方式来切换，比如开始切换 10% 的流量，如果没有问题再切换到 50% 的流量，最后再切换到 100%

5. 由于有双写的存在，所以在切换的过程中出现任何的问题，都可以将读写流量随时切换到旧库去，保障系统的性能

6. 观察几天发现数据的迁移没有问题之后，就可以将数据库的双写改造成只写新库，数据的迁移也就完成了


## 级联同步方案
1. 将新库配置为旧库的从库，用作数据同步
2. 将一个备库配置为新库的从库，用作数据的备份
3. 等到三个库的写入一致后，将数据库的读流量切换到新库
4. 然后暂停应用的写入，将业务的写入流量切换到新库


## 预热缓存

在云上部署多组 mc 的副本组，自建机房在接收到写入请求时，会优先写入自建机房的 缓存节点，异步写入云上部署的 mc 节点;
2. 在处理自建机房的读请求时，会指定一定的流量，比如 10%，优先走云上的缓存节点， 这样虽然也会走专线穿透回自建机房的缓存节点，但是流量是可控的;
3. 当云上缓存节点的命中率达到 90% 以上时，就可以在云上部署应用服务器，让云上的应 用服务器完全走云上的缓存节点就可以了。
